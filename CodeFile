**Find earliest created date for a SalesForce Opportunity**
[First Opportunity Created Date] = DATE( {FIXED [Opportunity ID] : MIN([Created Date])})

**^This expression will be our vertical axis & Cohort groups - convert to month & discrete**

**Calculate the total opportunities that were created in the cohort that closed**
[Total Closed in Cohort] = TOTAL(COUNTD([Opportunity ID]))

**^This expression creates a fixed amount and is not effected by the table, allowing us to do various calculations to the main cohort group**

**Calculate the months between the earliest created date & the closed date**
[Period] = DATEDIFF ('month', [First Opportunity Created Date], ([Close Date]))

**^ This expression will be our horizontal axis, showing us know how many opps are closed after x months from the created date, must convert to discrete & dimension**

**Count distinct opportunities that are closed in the respective period - this will act as a variable in our main calculation**
[Opportunities Closed] = COUNTD ([Opportunity ID])

**Calculate the percent of opportunities closed for a given period by the total closed in the respectivie Cohort**
[Closed Percent of Total] = [Opportunities Closed] / [Total Closed in Cohort]

**CALCULATE MAIN FIELDS ** 
**This will show the percentage of opportunities closed of the total in the respective period for all cohort groups**

[Opportunity Calculation %] =

IFNULL(

        IF[Closed Percent of Total] = 0 

            THEN NULL

            ELSE [Closed Percent of Total]

        END,

        RUNNING_AVG([Closed Percent of Total]))
                                    
**^ The expression will convert 0% (Periods that have no opportunities closed) to NULL, the IFNULL function then will convert the NULL values to 
the running average of the table - this will help us forecast how many opportunities created in the cohort will close in x months**

**This will show the count of closed opportunities in the respective period, if none are closed in x period in the cohort, NUll is replaced with 0**

[Opportunity Calculation Count] = 

IF [Opportunities Closed] <> 0 

    THEN [Opportunities Closed]

    ELSE 
    
        IF RUNNING_SUM(COUNTD([Opportunity ID]))<[Total Closed in Cohort]

            THEN 0
                    
            ELSE NULL
                    
        END

END

**Current filters in Tableau Workbook

Won = "True"
Opportunity Type = "New Business - New Logo" & "New Subscription"
Company Name = "Appspace" & "Appspace Inc."


I am noticing that most of the opportunities are created and closed in the same month - need to discuss filtering out "quick deals" 
(credit card monthly deals, small dollar deals?) to determine accurate close cycle** 
